<!DOCTYPE html>
<html>
<head>
    <meta charset="ISO-8859-1">
    <title>Booking Management</title>
    <link rel="stylesheet" href="../css/bookManagement.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css">
    <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"
    ></script>
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.js"></script>
    <script type="text/javascript">
        var link = window.location.href.toString();
        var auth = link.substring(73, link.length)
        var bookings = {}
        var table;
        $(document).ready(function () {
            $.getJSON("http://localhost:8080/HotelChainManagementSystem/services/book-management/bookings" + auth, function (data) {
                bookings.roomType = data.roomTypeNames;
                bookings.checkIn = data.checkInDates;
                bookings.checkOut = data.checkOutDates;
                bookings.numberOfRooms = data.numberOfRooms;
                bookings.hotelID = data.hotelIDs

                for (let i = 0; i < bookings.roomType.length; i++) {
                    $('#table-body').append("<tr> <td>" +
                        bookings.roomType[i] + "</td> <td>" + bookings.checkIn[i] + "</td> <td>" +
                        bookings.checkOut[i] + "</td> <td>" + bookings.numberOfRooms[i] + "</td> <td><button class='delete' id=" + i.toString() +
                        "> Delete </button> </td> </tr>");
                }

                table = $('#book-table').DataTable();
                $('.delete').on('click', function () {
                    console.log('clicked')
                    let r = $(this).closest('tr').index()
                    let id = parseInt(this.id);
                    let url = 'http://localhost:8080/HotelChainManagementSystem/services/book-management/' +
                                bookings.hotelID[id].toString() + '-' +
                                bookings.checkIn[id].substring(0, 4) + ":" + bookings.checkIn[id].substring(5, 7) + ':' + bookings.checkIn[id].substring(8, 10) + '-' +
                                bookings.checkOut[id].substring(0, 4) + ":" + bookings.checkOut[id].substring(5, 7) + ':' + bookings.checkOut[id].substring(8, 10) + '-' +
                                bookings.roomType[id] + auth;

                    fetch(url, {
                                method: 'DELETE',
                            }).then(() => {
                            table.row(r).remove().draw();
                    })

                })
            })

                // $('.delete').on('click', function () {
                //         let id = parseInt(this.id);
                //         console.log("clicked")
                //         let url = 'http://localhost:8080/HotelChainManagementSystem/services/book-management/' +
                //             bookings.hotelID[id].toString() + '-' +
                //             bookings.checkIn[id].substring(0, 4) + ":" + bookings.checkIn[id].substring(5, 7) + ':' + bookings.checkIn[id].substring(8, 10) + '-' +
                //             bookings.checkOut[id].substring(0, 4) + ":" + bookings.checkOut[id].substring(5, 7) + ':' + bookings.checkOut[id].substring(8, 10) + '-' +
                //             bookings.roomType[id] + auth;
                //         console.log(url)
                //     fetch(url, {
                //         method: 'DELETE',
                //     })
                //         .then(res => res.text()) // or res.json()
                //         .then(res => console.log(res))
                //         .then(() => {
                //             bookings.roomType.splice(id, 1)
                //             bookings.checkIn.splice(id, 1)
                //             bookings.checkOut.splice(id, 1)
                //             bookings.numberOfRooms.splice(id, 1)
                //             console.log(bookings)
                //             $('#table-body').empty();
                //             for (let i = 0; i < bookings.roomType.length; i++) {
                //                 $('#table-body').append("<tr> <td>" +
                //                     bookings.roomType[i] + "</td> <td>" + bookings.checkIn[i] + "</td> <td>" +
                //                     bookings.checkOut[i] + "</td> <td>" + bookings.numberOfRooms[i] + "</td> <td><button class='delete' id=" + i.toString() +
                //                     "> Delete </button> </td> </tr>");
                //             }
                //
                //             table = $('#book-table').DataTable();
                //         })
                //
                //     }
                // )

        })

    </script>
</head>
<body>
<h2>
    <a href="http://localhost:8080/HotelChainManagementSystem/">Hotel Chain Management System</a>
</h2>
<div class="book-table">
    <table class="cell-border" id="book-table" style="width: 100%">
        <thead>
        <tr>
            <th>Room Type</th>
            <th>Check In</th>
            <th>Check Out</th>
            <th>Number of Rooms</th>
            <th>Delete</th>
        </tr>
        </thead>
        <tbody id="table-body">
        <tr>
            <td style="display: none"></td>
            <td style="display:none;"></td>
            <td style="display: none"></td>
            <td style="display: none"></td>
            <td style="display: none"></td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>